<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="viewmastR">
<title>How to use a bulk dataset as a reference for viewmastR • viewmastR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="How to use a bulk dataset as a reference for viewmastR">
<meta property="og:description" content="viewmastR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">viewmastR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Get Started</h6>
    <a class="dropdown-item" href="../articles/HowTo.html">How to use viewmastR</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Advanced</h6>
    <a class="dropdown-item" href="../articles/InDepth.html">A deeper look at viewmastR</a>
    <a class="dropdown-item" href="../articles/BulkReference.html">How to use a bulk dataset as a reference for viewmastR</a>
    <a class="dropdown-item" href="../articles/Augment.html">How to augment data using viewmastR</a>
    <a class="dropdown-item" href="../articles/SavedModel.html">How to use viewmastR with saved models</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="http://twitter.com/scottfurlan" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/furlan-lab/viewmastR" aria-label="GitHub">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>How to use a bulk dataset as a reference for viewmastR</h1>
            
            <h4 data-toc-skip class="date">2024-01-26</h4>
      
      
      <div class="d-none name"><code>BulkReference.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="installing-rust">Installing Rust<a class="anchor" aria-label="anchor" href="#installing-rust"></a>
</h2>
<p>First you need to have an updated Rust installation. Go to this <a href="https://www.rust-lang.org/tools/install" class="external-link">site</a> to learn how to
install Rust.</p>
</div>
<div class="section level2">
<h2 id="installing-viewmastr">Installing viewmastR<a class="anchor" aria-label="anchor" href="#installing-viewmastr"></a>
</h2>
<p>You will need to have the devtools package installed…</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"furlan-lab/viewmastR"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-a-few-datasets">Load a few datasets<a class="anchor" aria-label="anchor" href="#load-a-few-datasets"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://furlan-lab.github.io/viewmastR/">viewmastR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mojaveazure.github.io/seurat-object/" class="external-link">SeuratObject</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/samuel-marsh/scCustomize" class="external-link">scCustomize</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/SummarizedExperiment" class="external-link">SummarizedExperiment</a></span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#malignant ref (bulk)</span></span>
<span><span class="va">seuMR</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ROOT_DIR1</span>, <span class="st">"240126_AML_object.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">seMR</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ROOT_DIR1</span>, <span class="st">"240126_Combined_SE_Object.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#healthy ref (sc)</span></span>
<span><span class="va">seuHR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ROOT_DIR3</span>, <span class="st">"230329_rnaAugmented_seurat.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#query dataset</span></span>
<span><span class="va">seuP</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ROOT_DIR2</span>, <span class="st">"220831_ptdata.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="make-a-bulk-classifier">Make a bulk classifier<a class="anchor" aria-label="anchor" href="#make-a-bulk-classifier"></a>
</h2>
<p>We can then see how this classifies cells from a scRNAseq experiment.
This is first done by loading the data and creating a [Summarized
Experiment] (<a href="https://bioconductor.org/packages/release/bioc/html/SummarizedExperiment.html" class="external-link uri">https://bioconductor.org/packages/release/bioc/html/SummarizedExperiment.html</a>).
We remove a few malignant/modified cells from the reference. The
function “splat_bulk_reference” takes a SummarizedExperiment and returns
a Seurat object made by generating pseudo-single-cell data which can
then be used as a reference for viewmastR. We invoke viewmastR. Although
it is not necessary, we can then visualize a UMAP of the
single-cellified bulk reference using a standard Seurat workflow.
Finally, we can visualize the bulk viewmastR classification result
compared to the published cell labels. While, we see fairly faithful
overlap, the bulk reference does not contain samples for all the
celltypes, so cells such as plasma cells and cDCs are called other
celltypes.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">allcounts</span>, header <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">dat</span><span class="op">$</span><span class="va">X_TranscriptID</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">X_TranscriptID</span><span class="op">&lt;-</span><span class="cn">NULL</span></span>
<span><span class="va">metad</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="st">"[["</span>, <span class="fl">1</span><span class="op">)</span>, celltype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="st">"[["</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rowd</span><span class="op">&lt;-</span><span class="fu">DataFrame</span><span class="op">(</span>gene_short_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">obj</span><span class="op">&lt;-</span><span class="fu">SummarizedExperiment</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/RangedSummarizedExperiment-class.html" class="external-link">SummarizedExperiment</a></span><span class="op">(</span>assays <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>counts<span class="op">=</span><span class="va">dat</span><span class="op">)</span>, rowData <span class="op">=</span> <span class="va">rowd</span>, colData <span class="op">=</span> <span class="va">metad</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#remove samples we don't want</span></span>
<span><span class="va">obj</span><span class="op">&lt;-</span><span class="va">obj</span><span class="op">[</span>,<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^Blast"</span>, <span class="va">obj</span><span class="op">$</span><span class="va">celltype</span><span class="op">)</span><span class="op">]</span> <span class="co">#blasts</span></span>
<span><span class="va">obj</span><span class="op">&lt;-</span><span class="va">obj</span><span class="op">[</span>,<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^rHSC"</span>, <span class="va">obj</span><span class="op">$</span><span class="va">celltype</span><span class="op">)</span><span class="op">]</span> <span class="co">#recombinant HSCs</span></span>
<span><span class="va">obj</span><span class="op">&lt;-</span><span class="va">obj</span><span class="op">[</span>,<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^LSC"</span>, <span class="va">obj</span><span class="op">$</span><span class="va">celltype</span><span class="op">)</span><span class="op">]</span> <span class="co">#leukemia stem cells</span></span>
<span><span class="co">#obj&lt;-obj[,obj$sample %in% c("X5852", "X5483")] #two donors</span></span>
<span></span>
<span><span class="co">#undebug(splat_bulk_reference)</span></span>
<span><span class="va">seuF</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/splat_bulk_reference.html">splat_bulk_reference</a></span><span class="op">(</span><span class="va">seuHR</span>, <span class="va">obj</span>, N<span class="op">=</span><span class="fl">200</span><span class="op">)</span></span>
<span></span>
<span><span class="va">seuF</span><span class="op">&lt;-</span><span class="fu"><a href="https://satijalab.org/seurat/reference/NormalizeData.html" class="external-link">NormalizeData</a></span><span class="op">(</span><span class="va">seuF</span><span class="op">)</span></span>
<span><span class="va">seuF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html" class="external-link">FindVariableFeatures</a></span><span class="op">(</span><span class="va">seuF</span>,  nfeatures <span class="op">=</span> <span class="fl">1000</span>, assay <span class="op">=</span> <span class="st">"RNA"</span><span class="op">)</span></span>
<span><span class="va">seuF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html" class="external-link">ScaleData</a></span><span class="op">(</span><span class="va">seuF</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html" class="external-link">RunPCA</a></span><span class="op">(</span>features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/VariableFeatures.html" class="external-link">VariableFeatures</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">seuF</span><span class="op">)</span>, npcs <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/ElbowPlot.html" class="external-link">ElbowPlot</a></span><span class="op">(</span><span class="va">seuF</span>, <span class="fl">100</span><span class="op">)</span> </span></code></pre></div>
<p><img src="BulkReference_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seuF</span><span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindNeighbors.html" class="external-link">FindNeighbors</a></span><span class="op">(</span><span class="va">seuF</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">seuF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindClusters.html" class="external-link">FindClusters</a></span><span class="op">(</span><span class="va">seuF</span>, resolution <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of nodes: 9800</span></span>
<span><span class="co">## Number of edges: 363869</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Running Louvain algorithm...</span></span>
<span><span class="co">## Maximum modularity in 10 random starts: 0.9526</span></span>
<span><span class="co">## Number of communities: 34</span></span>
<span><span class="co">## Elapsed time: 0 seconds</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seuF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html" class="external-link">RunUMAP</a></span><span class="op">(</span><span class="va">seuF</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, n.components <span class="op">=</span> <span class="fl">2</span>, min.dist <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">seuF</span>, group.by <span class="op">=</span> <span class="st">"celltype"</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">polychrome</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="BulkReference_files/figure-html/unnamed-chunk-4-2.png" width="100%"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">seuF</span>, group.by <span class="op">=</span> <span class="st">"sample"</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">polychrome</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="BulkReference_files/figure-html/unnamed-chunk-4-3.png" width="100%"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seuF</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/calculate_gene_dispersion.html">calculate_gene_dispersion</a></span><span class="op">(</span><span class="va">seuF</span><span class="op">)</span></span>
<span><span class="va">seuF</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/select_genes.html">select_genes</a></span><span class="op">(</span><span class="va">seuF</span>, top_n <span class="op">=</span> <span class="fl">10000</span>, logmean_ul <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, logmean_ll <span class="op">=</span> <span class="op">-</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">vgr</span><span class="op">&lt;-</span><span class="fu">get_selected_genes</span><span class="op">(</span><span class="va">seuF</span><span class="op">)</span></span>
<span><span class="va">seuHR</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/calculate_gene_dispersion.html">calculate_gene_dispersion</a></span><span class="op">(</span><span class="va">seuHR</span><span class="op">)</span></span>
<span><span class="va">seuHR</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/select_genes.html">select_genes</a></span><span class="op">(</span><span class="va">seuHR</span>, top_n <span class="op">=</span> <span class="fl">10000</span>, logmean_ul <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, logmean_ll <span class="op">=</span> <span class="op">-</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">vgq</span><span class="op">&lt;-</span><span class="fu">get_selected_genes</span><span class="op">(</span><span class="va">seuHR</span><span class="op">)</span></span>
<span><span class="va">vg</span><span class="op">&lt;-</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">vgq</span>, <span class="va">vgr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">seuHR</span><span class="op">&lt;-</span><span class="fu">viewmastR</span><span class="fu">::</span><span class="fu"><a href="../reference/viewmastR.html">viewmastR</a></span><span class="op">(</span>query_cds <span class="op">=</span> <span class="va">seuHR</span>, ref_cds <span class="op">=</span> <span class="va">seuF</span>, ref_celldata_col <span class="op">=</span> <span class="st">"celltype"</span>, selected_genes <span class="op">=</span> <span class="va">vg</span><span class="op">)</span></span>
<span><span class="va">cols</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">seuHR</span><span class="op">@</span><span class="va">misc</span><span class="op">$</span><span class="va">colors</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">14</span>,<span class="fl">18</span>,<span class="fl">20</span>,<span class="fl">6</span>,<span class="fl">5</span>,<span class="fl">3</span>,<span class="fl">7</span>,<span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">2</span>,<span class="fl">11</span><span class="op">)</span><span class="op">]</span>, <span class="st">"cyan"</span>, <span class="va">seuHR</span><span class="op">@</span><span class="va">misc</span><span class="op">$</span><span class="va">colors</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">21</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cols</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">seuF</span><span class="op">$</span><span class="va">celltype</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://samuel-marsh.github.io/scCustomize/reference/DimPlot_scCustom.html" class="external-link">DimPlot_scCustom</a></span><span class="op">(</span><span class="va">seuHR</span>, group.by <span class="op">=</span> <span class="st">"viewmastR_pred"</span>, colors_use  <span class="op">=</span> <span class="va">cols</span>, label <span class="op">=</span> <span class="cn">T</span>, repel <span class="op">=</span> <span class="cn">T</span>, label.box <span class="op">=</span> <span class="cn">T</span>, label.color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BulkReference_files/figure-html/unnamed-chunk-4-4.png" width="100%"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://samuel-marsh.github.io/scCustomize/reference/DimPlot_scCustom.html" class="external-link">DimPlot_scCustom</a></span><span class="op">(</span><span class="va">seuHR</span>, group.by <span class="op">=</span> <span class="st">"SFClassification"</span>, colors_use  <span class="op">=</span> <span class="va">seuHR</span><span class="op">@</span><span class="va">misc</span><span class="op">$</span><span class="va">colors</span>, label <span class="op">=</span> <span class="cn">T</span>, repel <span class="op">=</span> <span class="cn">T</span>, label.box <span class="op">=</span> <span class="cn">T</span>, label.color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BulkReference_files/figure-html/unnamed-chunk-4-5.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="lets-look-at-a-patient">Let’s look at a patient<a class="anchor" aria-label="anchor" href="#lets-look-at-a-patient"></a>
</h2>
<p>This patient is post transplant with evidence of chimerism. Let’s run
viewmastR using a reference of healthy BM on the cells to see how the
cells annotate</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seuP</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/calculate_gene_dispersion.html">calculate_gene_dispersion</a></span><span class="op">(</span><span class="va">seuP</span><span class="op">)</span></span>
<span><span class="va">seuP</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/select_genes.html">select_genes</a></span><span class="op">(</span><span class="va">seuP</span>, top_n <span class="op">=</span> <span class="fl">10000</span>, logmean_ul <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, logmean_ll <span class="op">=</span> <span class="op">-</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">vgr</span><span class="op">&lt;-</span><span class="fu">get_selected_genes</span><span class="op">(</span><span class="va">seuP</span><span class="op">)</span></span>
<span><span class="va">seuHR</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/calculate_gene_dispersion.html">calculate_gene_dispersion</a></span><span class="op">(</span><span class="va">seuHR</span><span class="op">)</span></span>
<span><span class="va">seuHR</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/select_genes.html">select_genes</a></span><span class="op">(</span><span class="va">seuHR</span>, top_n <span class="op">=</span> <span class="fl">10000</span>, logmean_ul <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, logmean_ll <span class="op">=</span> <span class="op">-</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">vgq</span><span class="op">&lt;-</span><span class="fu">get_selected_genes</span><span class="op">(</span><span class="va">seuHR</span><span class="op">)</span></span>
<span><span class="va">vg</span><span class="op">&lt;-</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">vgq</span>, <span class="va">vgr</span><span class="op">)</span></span>
<span><span class="va">seuP</span><span class="op">&lt;-</span><span class="fu">viewmastR</span><span class="fu">::</span><span class="fu"><a href="../reference/viewmastR.html">viewmastR</a></span><span class="op">(</span>query_cds <span class="op">=</span> <span class="va">seuP</span>, ref_cds <span class="op">=</span> <span class="va">seuHR</span>, ref_celldata_col <span class="op">=</span> <span class="st">"SFClassification"</span>, selected_genes <span class="op">=</span> <span class="va">vg</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://samuel-marsh.github.io/scCustomize/reference/DimPlot_scCustom.html" class="external-link">DimPlot_scCustom</a></span><span class="op">(</span><span class="va">seuP</span>, group.by <span class="op">=</span> <span class="st">"viewmastR_pred"</span>, colors_use <span class="op">=</span> <span class="va">seuHR</span><span class="op">@</span><span class="va">misc</span><span class="op">$</span><span class="va">colors</span><span class="op">)</span></span></code></pre></div>
<p><img src="BulkReference_files/figure-html/unnamed-chunk-5-1.png" width="100%"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seuP</span><span class="op">$</span><span class="va">geno_label</span><span class="op">&lt;-</span><span class="va">seuP</span><span class="op">$</span><span class="va">geno</span></span>
<span><span class="va">seuP</span><span class="op">$</span><span class="va">geno_label</span><span class="op">[</span><span class="va">seuP</span><span class="op">$</span><span class="va">geno</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"0"</span><span class="op">]</span><span class="op">&lt;-</span><span class="st">"Donor"</span></span>
<span><span class="va">seuP</span><span class="op">$</span><span class="va">geno_label</span><span class="op">[</span><span class="va">seuP</span><span class="op">$</span><span class="va">geno</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"1"</span><span class="op">]</span><span class="op">&lt;-</span><span class="st">"Recipient"</span></span>
<span><span class="fu"><a href="https://samuel-marsh.github.io/scCustomize/reference/DimPlot_scCustom.html" class="external-link">DimPlot_scCustom</a></span><span class="op">(</span><span class="va">seuP</span>, group.by <span class="op">=</span> <span class="st">"geno_label"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BulkReference_files/figure-html/unnamed-chunk-6-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="interesting-that-we-see-some-lymphoidb-signature-in-this-patient-with-a-runx1-runx1t1-fusion">Interesting that we see some lymphoid/B signature in this patient
with a RUNX1-RUNX1T1 fusion<a class="anchor" aria-label="anchor" href="#interesting-that-we-see-some-lymphoidb-signature-in-this-patient-with-a-runx1-runx1t1-fusion"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/Idents.html" class="external-link">Idents</a></span><span class="op">(</span><span class="va">seuP</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">seuP</span><span class="op">$</span><span class="va">viewmastR_pred</span></span>
<span><span class="co">#levels(factor(as.character(seuP$viewmastR_pred)))</span></span>
<span><span class="fu"><a href="https://samuel-marsh.github.io/scCustomize/reference/Cluster_Highlight_Plot.html" class="external-link">Cluster_Highlight_Plot</a></span><span class="op">(</span><span class="va">seuP</span>, cluster_name <span class="op">=</span> <span class="st">"06_CLP"</span>, highlight_color <span class="op">=</span> <span class="va">seuHR</span><span class="op">@</span><span class="va">misc</span><span class="op">$</span><span class="va">colors</span><span class="op">)</span></span></code></pre></div>
<p><img src="BulkReference_files/figure-html/unnamed-chunk-7-1.png" width="100%"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://samuel-marsh.github.io/scCustomize/reference/Cluster_Highlight_Plot.html" class="external-link">Cluster_Highlight_Plot</a></span><span class="op">(</span><span class="va">seuP</span>, cluster_name <span class="op">=</span> <span class="st">"13_Pre.B"</span>, highlight_color <span class="op">=</span> <span class="va">seuHR</span><span class="op">@</span><span class="va">misc</span><span class="op">$</span><span class="va">colors</span><span class="op">)</span></span></code></pre></div>
<p><img src="BulkReference_files/figure-html/unnamed-chunk-7-2.png" width="100%"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://samuel-marsh.github.io/scCustomize/reference/Cluster_Highlight_Plot.html" class="external-link">Cluster_Highlight_Plot</a></span><span class="op">(</span><span class="va">seuP</span>, cluster_name <span class="op">=</span> <span class="st">"14_B"</span>, highlight_color <span class="op">=</span> <span class="va">seuHR</span><span class="op">@</span><span class="va">misc</span><span class="op">$</span><span class="va">colors</span><span class="op">)</span></span></code></pre></div>
<p><img src="BulkReference_files/figure-html/unnamed-chunk-7-3.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="lets-investigate-how-the-tumor-annotates-using-a-bulk-reference-of-leukemia-cases">Let’s investigate how the tumor annotates using a bulk reference of
leukemia cases<a class="anchor" aria-label="anchor" href="#lets-investigate-how-the-tumor-annotates-using-a-bulk-reference-of-leukemia-cases"></a>
</h2>
<p>First we will pare down the data into a min of 3 and a max of 20
cases per leukemia subgroup. We will make 10 cells from each case, then
use the resulting reference to classify the patient sample. There seems
to be a Ph signature in this case even though the majority of the tumor
cells annotate correctly as RUNX1-RUNX1T1</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj</span><span class="op">&lt;-</span><span class="va">seMR</span></span>
<span><span class="co">#rowData(obj)</span></span>
<span><span class="va">sttk</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">final_group</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">final_group</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">sttk</span><span class="op">&lt;-</span><span class="va">sttk</span><span class="op">[</span><span class="op">!</span><span class="va">sttk</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Other"</span><span class="op">]</span></span>
<span><span class="va">case_max</span><span class="op">&lt;-</span><span class="fl">20</span></span>
<span></span>
<span><span class="va">obj</span><span class="op">&lt;-</span><span class="va">obj</span><span class="op">[</span>,<span class="va">obj</span><span class="op">$</span><span class="va">final_group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sttk</span><span class="op">]</span></span>
<span><span class="va">ds</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">final_group</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">final_group</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">20</span><span class="op">]</span></span>
<span><span class="va">ctk</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">final_group</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">type</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">cases</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">final_group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">type</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cases</span><span class="op">)</span><span class="op">&gt;</span><span class="va">case_max</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">cases</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">cases</span>, <span class="va">case_max</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">cases</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">obj</span><span class="op">&lt;-</span><span class="va">obj</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">ctk</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">ctk</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#table(obj$final_group)</span></span>
<span></span>
<span><span class="co">#debug(splat_bulk_reference)</span></span>
<span><span class="va">seuF</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/splat_bulk_reference.html">splat_bulk_reference</a></span><span class="op">(</span><span class="va">seuP</span>, <span class="va">obj</span>, N<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">seuF</span><span class="op">&lt;-</span><span class="fu"><a href="https://satijalab.org/seurat/reference/NormalizeData.html" class="external-link">NormalizeData</a></span><span class="op">(</span><span class="va">seuF</span><span class="op">)</span></span>
<span><span class="va">seuF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html" class="external-link">FindVariableFeatures</a></span><span class="op">(</span><span class="va">seuF</span>,  nfeatures <span class="op">=</span> <span class="fl">1000</span>, assay <span class="op">=</span> <span class="st">"RNA"</span><span class="op">)</span></span>
<span><span class="va">seuF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/ScaleData.html" class="external-link">ScaleData</a></span><span class="op">(</span><span class="va">seuF</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html" class="external-link">RunPCA</a></span><span class="op">(</span>features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/VariableFeatures.html" class="external-link">VariableFeatures</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">seuF</span><span class="op">)</span>, npcs <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/ElbowPlot.html" class="external-link">ElbowPlot</a></span><span class="op">(</span><span class="va">seuF</span>, <span class="fl">100</span><span class="op">)</span> </span></code></pre></div>
<p><img src="BulkReference_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seuF</span><span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindNeighbors.html" class="external-link">FindNeighbors</a></span><span class="op">(</span><span class="va">seuF</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">seuF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindClusters.html" class="external-link">FindClusters</a></span><span class="op">(</span><span class="va">seuF</span>, resolution <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of nodes: 7360</span></span>
<span><span class="co">## Number of edges: 200459</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Running Louvain algorithm...</span></span>
<span><span class="co">## Maximum modularity in 10 random starts: 0.9018</span></span>
<span><span class="co">## Number of communities: 34</span></span>
<span><span class="co">## Elapsed time: 0 seconds</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seuF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html" class="external-link">RunUMAP</a></span><span class="op">(</span><span class="va">seuF</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, n.components <span class="op">=</span> <span class="fl">2</span>, min.dist <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">seuF</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/calculate_gene_dispersion.html">calculate_gene_dispersion</a></span><span class="op">(</span><span class="va">seuF</span><span class="op">)</span></span>
<span><span class="va">seuF</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/select_genes.html">select_genes</a></span><span class="op">(</span><span class="va">seuF</span>, top_n <span class="op">=</span> <span class="fl">10000</span>, logmean_ul <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, logmean_ll <span class="op">=</span> <span class="op">-</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">vgr</span><span class="op">&lt;-</span><span class="fu">get_selected_genes</span><span class="op">(</span><span class="va">seuF</span><span class="op">)</span></span>
<span><span class="va">seuP</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/calculate_gene_dispersion.html">calculate_gene_dispersion</a></span><span class="op">(</span><span class="va">seuP</span><span class="op">)</span></span>
<span><span class="va">seuP</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/select_genes.html">select_genes</a></span><span class="op">(</span><span class="va">seuP</span>, top_n <span class="op">=</span> <span class="fl">10000</span>, logmean_ul <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, logmean_ll <span class="op">=</span> <span class="op">-</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">vgq</span><span class="op">&lt;-</span><span class="fu">get_selected_genes</span><span class="op">(</span><span class="va">seuP</span><span class="op">)</span></span>
<span><span class="va">vg</span><span class="op">&lt;-</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">vgq</span>, <span class="va">vgr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">seuP</span><span class="op">&lt;-</span><span class="fu">viewmastR</span><span class="fu">::</span><span class="fu"><a href="../reference/viewmastR.html">viewmastR</a></span><span class="op">(</span>query_cds <span class="op">=</span> <span class="va">seuP</span>, ref_cds <span class="op">=</span> <span class="va">seuF</span>, ref_celldata_col <span class="op">=</span> <span class="st">"final_group"</span>, selected_genes <span class="op">=</span> <span class="va">vg</span><span class="op">)</span></span>
<span></span>
<span><span class="va">thresh</span><span class="op">&lt;-</span><span class="fl">100</span></span>
<span><span class="va">seuP</span><span class="op">$</span><span class="va">pred_thresh</span><span class="op">&lt;-</span><span class="va">seuP</span><span class="op">$</span><span class="va">viewmastR_pred</span></span>
<span><span class="va">seuP</span><span class="op">$</span><span class="va">pred_thresh</span><span class="op">[</span><span class="va">seuP</span><span class="op">$</span><span class="va">pred_thresh</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">seuP</span><span class="op">$</span><span class="va">viewmastR_pred</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">seuP</span><span class="op">$</span><span class="va">viewmastR_pred</span><span class="op">)</span><span class="op">&lt;</span><span class="va">thresh</span><span class="op">]</span><span class="op">]</span><span class="op">&lt;-</span><span class="st">"Other"</span></span>
<span><span class="fu"><a href="https://samuel-marsh.github.io/scCustomize/reference/DimPlot_scCustom.html" class="external-link">DimPlot_scCustom</a></span><span class="op">(</span><span class="va">seuP</span>, group.by <span class="op">=</span> <span class="st">"pred_thresh"</span><span class="op">)</span></span></code></pre></div>
<p><img src="BulkReference_files/figure-html/unnamed-chunk-8-2.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.3.1 (2023-06-16)</span></span>
<span><span class="co">## Platform: x86_64-apple-darwin20 (64-bit)</span></span>
<span><span class="co">## Running under: macOS Sonoma 14.6.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib </span></span>
<span><span class="co">## LAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: America/Los_Angeles</span></span>
<span><span class="co">## tzcode source: internal</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] SummarizedExperiment_1.30.2 Biobase_2.60.0             </span></span>
<span><span class="co">##  [3] GenomicRanges_1.52.1        GenomeInfoDb_1.41.1        </span></span>
<span><span class="co">##  [5] IRanges_2.34.1              S4Vectors_0.38.2           </span></span>
<span><span class="co">##  [7] BiocGenerics_0.46.0         MatrixGenerics_1.12.3      </span></span>
<span><span class="co">##  [9] matrixStats_1.2.0           magrittr_2.0.3             </span></span>
<span><span class="co">## [11] scCustomize_2.1.2           ggplot2_3.5.0              </span></span>
<span><span class="co">## [13] Seurat_5.0.3                SeuratObject_5.0.1         </span></span>
<span><span class="co">## [15] sp_2.1-3                    viewmastR_0.2.3            </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] fs_1.6.3                    spatstat.sparse_3.0-3      </span></span>
<span><span class="co">##   [3] bitops_1.0-7                RcppMsgPack_0.2.3          </span></span>
<span><span class="co">##   [5] lubridate_1.9.3             httr_1.4.7                 </span></span>
<span><span class="co">##   [7] RColorBrewer_1.1-3          doParallel_1.0.17          </span></span>
<span><span class="co">##   [9] tools_4.3.1                 sctransform_0.4.1          </span></span>
<span><span class="co">##  [11] backports_1.4.1             utf8_1.2.4                 </span></span>
<span><span class="co">##  [13] R6_2.5.1                    lazyeval_0.2.2             </span></span>
<span><span class="co">##  [15] uwot_0.1.16                 GetoptLong_1.0.5           </span></span>
<span><span class="co">##  [17] withr_3.0.0                 gridExtra_2.3              </span></span>
<span><span class="co">##  [19] progressr_0.14.0            cli_3.6.2                  </span></span>
<span><span class="co">##  [21] textshaping_0.3.7           spatstat.explore_3.2-6     </span></span>
<span><span class="co">##  [23] fastDummies_1.7.3           prismatic_1.1.1            </span></span>
<span><span class="co">##  [25] labeling_0.4.3              sass_0.4.9                 </span></span>
<span><span class="co">##  [27] spatstat.data_3.0-4         ggridges_0.5.6             </span></span>
<span><span class="co">##  [29] pbapply_1.7-2               pkgdown_2.0.7              </span></span>
<span><span class="co">##  [31] systemfonts_1.0.6           foreign_0.8-86             </span></span>
<span><span class="co">##  [33] dichromat_2.0-0.1           parallelly_1.37.1          </span></span>
<span><span class="co">##  [35] maps_3.4.2                  pals_1.8                   </span></span>
<span><span class="co">##  [37] rstudioapi_0.15.0           generics_0.1.3             </span></span>
<span><span class="co">##  [39] shape_1.4.6.1               ica_1.0-3                  </span></span>
<span><span class="co">##  [41] spatstat.random_3.2-3       dplyr_1.1.4                </span></span>
<span><span class="co">##  [43] Matrix_1.6-5                ggbeeswarm_0.7.2           </span></span>
<span><span class="co">##  [45] fansi_1.0.6                 abind_1.4-5                </span></span>
<span><span class="co">##  [47] lifecycle_1.0.4             yaml_2.3.8                 </span></span>
<span><span class="co">##  [49] snakecase_0.11.1            recipes_1.0.10             </span></span>
<span><span class="co">##  [51] Rtsne_0.17                  paletteer_1.6.0            </span></span>
<span><span class="co">##  [53] grid_4.3.1                  promises_1.2.1             </span></span>
<span><span class="co">##  [55] crayon_1.5.2                miniUI_0.1.1.1             </span></span>
<span><span class="co">##  [57] lattice_0.22-5              cowplot_1.1.3              </span></span>
<span><span class="co">##  [59] mapproj_1.2.11              pillar_1.9.0               </span></span>
<span><span class="co">##  [61] knitr_1.45                  ComplexHeatmap_2.16.0      </span></span>
<span><span class="co">##  [63] rjson_0.2.21                boot_1.3-28.1              </span></span>
<span><span class="co">##  [65] future.apply_1.11.1         codetools_0.2-19           </span></span>
<span><span class="co">##  [67] leiden_0.4.3.1              glue_1.7.0                 </span></span>
<span><span class="co">##  [69] data.table_1.15.2           vctrs_0.6.5                </span></span>
<span><span class="co">##  [71] png_0.1-8                   spam_2.10-0                </span></span>
<span><span class="co">##  [73] gtable_0.3.4                rematch2_2.1.2             </span></span>
<span><span class="co">##  [75] assertthat_0.2.1            cachem_1.0.8               </span></span>
<span><span class="co">##  [77] gower_1.0.1                 xfun_0.42                  </span></span>
<span><span class="co">##  [79] S4Arrays_1.2.0              mime_0.12                  </span></span>
<span><span class="co">##  [81] prodlim_2023.08.28          survival_3.5-7             </span></span>
<span><span class="co">##  [83] timeDate_4032.109           SingleCellExperiment_1.22.0</span></span>
<span><span class="co">##  [85] iterators_1.0.14            pbmcapply_1.5.1            </span></span>
<span><span class="co">##  [87] hardhat_1.3.1               lava_1.8.0                 </span></span>
<span><span class="co">##  [89] ellipsis_0.3.2              fitdistrplus_1.1-11        </span></span>
<span><span class="co">##  [91] ROCR_1.0-11                 ipred_0.9-14               </span></span>
<span><span class="co">##  [93] nlme_3.1-164                RcppAnnoy_0.0.22           </span></span>
<span><span class="co">##  [95] bslib_0.6.1                 irlba_2.3.5.1              </span></span>
<span><span class="co">##  [97] vipor_0.4.7                 KernSmooth_2.23-22         </span></span>
<span><span class="co">##  [99] rpart_4.1.23                colorspace_2.1-0           </span></span>
<span><span class="co">## [101] Hmisc_5.1-2                 nnet_7.3-19                </span></span>
<span><span class="co">## [103] ggrastr_1.0.2               tidyselect_1.2.1           </span></span>
<span><span class="co">## [105] compiler_4.3.1              htmlTable_2.4.2            </span></span>
<span><span class="co">## [107] desc_1.4.3                  DelayedArray_0.26.7        </span></span>
<span><span class="co">## [109] plotly_4.10.4               checkmate_2.3.1            </span></span>
<span><span class="co">## [111] scales_1.3.0                lmtest_0.9-40              </span></span>
<span><span class="co">## [113] stringr_1.5.1               digest_0.6.35              </span></span>
<span><span class="co">## [115] goftest_1.2-3               spatstat.utils_3.1-0       </span></span>
<span><span class="co">## [117] minqa_1.2.6                 rmarkdown_2.26             </span></span>
<span><span class="co">## [119] XVector_0.40.0              htmltools_0.5.7            </span></span>
<span><span class="co">## [121] pkgconfig_2.0.3             base64enc_0.1-3            </span></span>
<span><span class="co">## [123] lme4_1.1-35.1               sparseMatrixStats_1.12.2   </span></span>
<span><span class="co">## [125] highr_0.10                  fastmap_1.1.1              </span></span>
<span><span class="co">## [127] rlang_1.1.3                 GlobalOptions_0.1.2        </span></span>
<span><span class="co">## [129] htmlwidgets_1.6.4           UCSC.utils_1.1.0           </span></span>
<span><span class="co">## [131] shiny_1.8.0                 DelayedMatrixStats_1.22.6  </span></span>
<span><span class="co">## [133] farver_2.1.1                jquerylib_0.1.4            </span></span>
<span><span class="co">## [135] zoo_1.8-12                  jsonlite_1.8.8             </span></span>
<span><span class="co">## [137] ModelMetrics_1.2.2.2        RCurl_1.98-1.14            </span></span>
<span><span class="co">## [139] Formula_1.2-5               GenomeInfoDbData_1.2.10    </span></span>
<span><span class="co">## [141] dotCall64_1.1-1             patchwork_1.2.0            </span></span>
<span><span class="co">## [143] munsell_0.5.0               Rcpp_1.0.12                </span></span>
<span><span class="co">## [145] reticulate_1.35.0           stringi_1.8.3              </span></span>
<span><span class="co">## [147] pROC_1.18.5                 zlibbioc_1.46.0            </span></span>
<span><span class="co">## [149] MASS_7.3-60.0.1             plyr_1.8.9                 </span></span>
<span><span class="co">## [151] parallel_4.3.1              listenv_0.9.1              </span></span>
<span><span class="co">## [153] ggrepel_0.9.5               forcats_1.0.0              </span></span>
<span><span class="co">## [155] deldir_2.0-4                splines_4.3.1              </span></span>
<span><span class="co">## [157] tensor_1.5                  circlize_0.4.16            </span></span>
<span><span class="co">## [159] igraph_2.0.3                spatstat.geom_3.2-9        </span></span>
<span><span class="co">## [161] RcppHNSW_0.6.0              reshape2_1.4.4             </span></span>
<span><span class="co">## [163] evaluate_0.23               ggprism_1.0.4              </span></span>
<span><span class="co">## [165] nloptr_2.0.3                foreach_1.5.2              </span></span>
<span><span class="co">## [167] httpuv_1.6.14               RANN_2.6.1                 </span></span>
<span><span class="co">## [169] tidyr_1.3.1                 purrr_1.0.2                </span></span>
<span><span class="co">## [171] polyclip_1.10-6             future_1.33.1              </span></span>
<span><span class="co">## [173] clue_0.3-65                 scattermore_1.2            </span></span>
<span><span class="co">## [175] janitor_2.2.0               xtable_1.8-4               </span></span>
<span><span class="co">## [177] monocle3_1.4.3              RSpectra_0.16-1            </span></span>
<span><span class="co">## [179] later_1.3.2                 viridisLite_0.4.2          </span></span>
<span><span class="co">## [181] class_7.3-22                ragg_1.3.0                 </span></span>
<span><span class="co">## [183] tibble_3.2.1                memoise_2.0.1              </span></span>
<span><span class="co">## [185] beeswarm_0.4.0              cluster_2.1.6              </span></span>
<span><span class="co">## [187] timechange_0.3.0            globals_0.16.3             </span></span>
<span><span class="co">## [189] caret_6.0-94</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/Users/sfurlan/develop/viewmastR/vignettes"</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://furlan-lab.github.io" class="external-link">Scott Furlan</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
