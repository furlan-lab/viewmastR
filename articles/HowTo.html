<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="viewmastR">
<title>How to use viewmastR • viewmastR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="How to use viewmastR">
<meta property="og:description" content="viewmastR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">viewmastR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Get Started</h6>
    <a class="dropdown-item" href="../articles/HowTo.html">How to use viewmastR</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Advanced</h6>
    <a class="dropdown-item" href="../articles/Augment.html">How to augment data using viewmastR</a>
    <a class="dropdown-item" href="../articles/BulkReference.html">How to use a bulk dataset as a reference for viewmastR</a>
    <a class="dropdown-item" href="../articles/SavedModel.html">How to use viewmastR with saved models</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="http://twitter.com/scottfurlan" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/furlan-lab/viewmastR" aria-label="GitHub">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="HowTo_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="HowTo_files/plotly-binding-4.10.3/plotly.js"></script><script src="HowTo_files/typedarray-0.1/typedarray.min.js"></script><link href="HowTo_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="HowTo_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><link href="HowTo_files/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="HowTo_files/plotly-main-2.11.1/plotly-latest.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>How to use viewmastR</h1>
            
            <h4 data-toc-skip class="date">2024-01-23</h4>
      
      
      <div class="d-none name"><code>HowTo.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="installing-rust">Installing Rust<a class="anchor" aria-label="anchor" href="#installing-rust"></a>
</h2>
<p>First you need to have an updated Rust installation. Go to this <a href="https://www.rust-lang.org/tools/install" class="external-link">site</a> to learn how to
install Rust.</p>
</div>
<div class="section level2">
<h2 id="installing-viewmastr">Installing viewmastR<a class="anchor" aria-label="anchor" href="#installing-viewmastr"></a>
</h2>
<p>You will need to have the devtools package installed…</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"furlan-lab/viewmastR"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-viewmastr">Running viewmastR<a class="anchor" aria-label="anchor" href="#running-viewmastr"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://furlan-lab.github.io/viewmastR/">viewmastR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^gizmo"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.info.html" class="external-link">Sys.info</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="st">"nodename"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">ROOT_DIR1</span><span class="op">&lt;-</span><span class="st">"/fh/fast/furlan_s/experiments/MB_10X_5p/cds"</span></span>
<span>  <span class="va">ROOT_DIR2</span><span class="op">&lt;-</span><span class="st">"/fh/fast/furlan_s/grp/data/ddata/BM_data"</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">ROOT_DIR1</span><span class="op">&lt;-</span><span class="st">"/Users/sfurlan/Library/CloudStorage/OneDrive-SharedLibraries-FredHutchinsonCancerCenter/Furlan_Lab - General/experiments/MB_10X_5p/cds"</span></span>
<span>  <span class="va">ROOT_DIR2</span><span class="op">&lt;-</span><span class="st">"/Users/sfurlan/Library/CloudStorage/OneDrive-SharedLibraries-FredHutchinsonCancerCenter/Furlan_Lab - General/datasets/Healthy_BM_greenleaf"</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#query dataset</span></span>
<span><span class="va">seu</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ROOT_DIR1</span>, <span class="st">"220302_final_object.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#reference dataset</span></span>
<span><span class="va">seur</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ROOT_DIR2</span>, <span class="st">"230329_rnaAugmented_seurat.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#harmonize labels</span></span>
<span><span class="va">labels</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">seur</span><span class="op">$</span><span class="va">SFClassification</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">seu</span><span class="op">$</span><span class="va">ground_truth</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">seu</span><span class="op">$</span><span class="va">seurat_clusters</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">seu</span><span class="op">$</span><span class="va">ground_truth</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">labels</span><span class="op">[</span><span class="fl">11</span><span class="op">]</span>, <span class="co">#0</span></span>
<span>                            <span class="va">labels</span><span class="op">[</span><span class="fl">18</span><span class="op">]</span>, <span class="co">#1</span></span>
<span>                            <span class="va">labels</span><span class="op">[</span><span class="fl">11</span><span class="op">]</span>, <span class="co">#2</span></span>
<span>                            <span class="va">labels</span><span class="op">[</span><span class="fl">17</span><span class="op">]</span>, <span class="co">#3</span></span>
<span>                            <span class="va">labels</span><span class="op">[</span><span class="fl">20</span><span class="op">]</span>, <span class="co">#4</span></span>
<span>                            <span class="va">labels</span><span class="op">[</span><span class="fl">21</span><span class="op">]</span>, <span class="co">#5</span></span>
<span>                            <span class="va">labels</span><span class="op">[</span><span class="fl">14</span><span class="op">]</span>, <span class="co">#6</span></span>
<span>                            <span class="va">labels</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span>, <span class="co">#7</span></span>
<span>                            <span class="va">labels</span><span class="op">[</span><span class="fl">16</span><span class="op">]</span>, <span class="co">#8,</span></span>
<span>                            <span class="va">labels</span><span class="op">[</span><span class="fl">18</span><span class="op">]</span>, <span class="co">#9,</span></span>
<span>                            <span class="va">labels</span><span class="op">[</span><span class="fl">14</span><span class="op">]</span>, <span class="co">#10,</span></span>
<span>                            <span class="va">labels</span><span class="op">[</span><span class="fl">19</span><span class="op">]</span>, <span class="co">#11,</span></span>
<span>                            <span class="va">labels</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, <span class="co">#12,</span></span>
<span>                            <span class="va">labels</span><span class="op">[</span><span class="fl">11</span><span class="op">]</span>, <span class="co">#13,</span></span>
<span>                            <span class="va">labels</span><span class="op">[</span><span class="fl">11</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">seu</span><span class="op">$</span><span class="va">ground_truth</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">seu</span><span class="op">$</span><span class="va">ground_truth</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="lets-plot-ground-truth">Let’s plot ground truth<a class="anchor" aria-label="anchor" href="#lets-plot-ground-truth"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">seu</span>, group.by <span class="op">=</span> <span class="st">"ground_truth"</span>, cols <span class="op">=</span> <span class="va">seur</span><span class="op">@</span><span class="va">misc</span><span class="op">$</span><span class="va">colors</span><span class="op">)</span></span></code></pre></div>
<p><img src="HowTo_files/figure-html/unnamed-chunk-3-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="find-common-features">Find common features<a class="anchor" aria-label="anchor" href="#find-common-features"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seu</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/calculate_gene_dispersion.html">calculate_gene_dispersion</a></span><span class="op">(</span><span class="va">seu</span><span class="op">)</span></span>
<span><span class="fu">plot_gene_dispersion</span><span class="op">(</span><span class="va">seu</span><span class="op">)</span></span></code></pre></div>
<p><img src="HowTo_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seu</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/select_genes.html">select_genes</a></span><span class="op">(</span><span class="va">seu</span>, top_n <span class="op">=</span> <span class="fl">10000</span>, logmean_ul <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, logmean_ll <span class="op">=</span> <span class="op">-</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="fu">plot_gene_dispersion</span><span class="op">(</span><span class="va">seu</span><span class="op">)</span></span></code></pre></div>
<p><img src="HowTo_files/figure-html/unnamed-chunk-4-2.png" width="100%"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vgq</span><span class="op">&lt;-</span><span class="fu">get_selected_genes</span><span class="op">(</span><span class="va">seu</span><span class="op">)</span></span>
<span><span class="va">seur</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/calculate_gene_dispersion.html">calculate_gene_dispersion</a></span><span class="op">(</span><span class="va">seur</span><span class="op">)</span></span>
<span><span class="fu">plot_gene_dispersion</span><span class="op">(</span><span class="va">seur</span><span class="op">)</span></span></code></pre></div>
<p><img src="HowTo_files/figure-html/unnamed-chunk-4-3.png" width="100%"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seur</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/select_genes.html">select_genes</a></span><span class="op">(</span><span class="va">seur</span>, top_n <span class="op">=</span> <span class="fl">10000</span>, logmean_ul <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, logmean_ll <span class="op">=</span> <span class="op">-</span><span class="fl">8</span><span class="op">)</span></span>
<span><span class="fu">plot_gene_dispersion</span><span class="op">(</span><span class="va">seur</span><span class="op">)</span></span></code></pre></div>
<p><img src="HowTo_files/figure-html/unnamed-chunk-4-4.png" width="100%"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vgr</span><span class="op">&lt;-</span><span class="fu">get_selected_genes</span><span class="op">(</span><span class="va">seur</span><span class="op">)</span></span>
<span><span class="va">vg</span><span class="op">&lt;-</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">vgq</span>, <span class="va">vgr</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="here-are-the-reference-cell-types">Here are the reference cell types<a class="anchor" aria-label="anchor" href="#here-are-the-reference-cell-types"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">seur</span>, group.by <span class="op">=</span> <span class="st">"SFClassification"</span>, cols <span class="op">=</span> <span class="va">seur</span><span class="op">@</span><span class="va">misc</span><span class="op">$</span><span class="va">colors</span><span class="op">)</span></span></code></pre></div>
<p><img src="HowTo_files/figure-html/unnamed-chunk-5-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="now-you-run-viewmastr">Now you run viewmastR<a class="anchor" aria-label="anchor" href="#now-you-run-viewmastr"></a>
</h2>
<p>Note that this is the same invocation used as prior versions of
viewmastR but more output can be obtained (read further down)</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seu</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/viewmastR.html">viewmastR</a></span><span class="op">(</span><span class="va">seu</span>, <span class="va">seur</span>, ref_celldata_col <span class="op">=</span> <span class="st">"SFClassification"</span>, selected_genes <span class="op">=</span> <span class="va">vg</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-look-at-the-predictions">A look at the predictions<a class="anchor" aria-label="anchor" href="#a-look-at-the-predictions"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">seu</span>, group.by <span class="op">=</span> <span class="st">"viewmastR_smr"</span>, cols <span class="op">=</span> <span class="va">seur</span><span class="op">@</span><span class="va">misc</span><span class="op">$</span><span class="va">colors</span><span class="op">)</span></span></code></pre></div>
<p><img src="HowTo_files/figure-html/unnamed-chunk-7-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="a-confusion-matrix-showing-prediction-vs-ground-truth">A confusion matrix showing prediction vs ground truth<a class="anchor" aria-label="anchor" href="#a-confusion-matrix-showing-prediction-vs-ground-truth"></a>
</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/confusion_matrix.html">confusion_matrix</a></span><span class="op">(</span>pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">seu</span><span class="op">$</span><span class="va">viewmastR_smr</span><span class="op">)</span>, gt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">seu</span><span class="op">$</span><span class="va">ground_truth</span><span class="op">)</span>, cols <span class="op">=</span> <span class="va">seur</span><span class="op">@</span><span class="va">misc</span><span class="op">$</span><span class="va">colors</span><span class="op">)</span></span></code></pre></div>
<p><img src="HowTo_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="a-look-at-the-training-history">A look at the training history<a class="anchor" aria-label="anchor" href="#a-look-at-the-training-history"></a>
</h2>
<p>ViewmastR records key learning data generated during training. This
can optionally be returned by setting the ‘return_type’ parameter to
“list”. Using this setting, the function will return a named list
containing the following items (1 named ‘object’) - the query object
with the celltype prediction added to the metadata (as above) and (2
named “training output”) a set of results obtained during training.
Here’s an example of how this may be used. First we run viewmastR again
changing the return type…</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_list</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/viewmastR.html">viewmastR</a></span><span class="op">(</span><span class="va">seu</span>, <span class="va">seur</span>, ref_celldata_col <span class="op">=</span> <span class="st">"SFClassification"</span>, selected_genes <span class="op">=</span> <span class="va">vg</span>, return_type<span class="op">=</span> <span class="st">"list"</span><span class="op">)</span></span></code></pre></div>
<p>Now we can plot learning data. We can see that the training loss
continues to decrease steadily beyond the 6th epoch, yet the validation
loss does not. This suggests that we are potentially overfitting after 6
epochs.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_training_data.html">plot_training_data</a></span><span class="op">(</span><span class="va">output_list</span><span class="op">)</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item" id="htmlwidget-3be2611e3736ed032e0c" style="width:100%;height:403.2px;"></div>
<script type="application/json" data-for="htmlwidget-3be2611e3736ed032e0c">{"x":{"data":[{"x":[1,2,3,4,5,6,7,8,9,10],"y":[90.828999999999994,97.186000000000007,98.596999999999994,99.388999999999996,99.781000000000006,99.930999999999997,99.988,99.995000000000005,100,100],"mode":"lines+markers","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)","width":3}},"type":"scatter","name":"train_accuracy","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10],"y":[95.027000000000001,95.626999999999995,95.608000000000004,95.715999999999994,95.805000000000007,95.754999999999995,95.677000000000007,95.754999999999995,95.754999999999995,95.686000000000007],"mode":"lines+markers","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)","width":3}},"type":"scatter","name":"validation_accuracy","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10],"y":[0.4622,0.29366999999999999,0.22137000000000001,0.17862,0.14979999999999999,0.12891,0.11304,0.10056,0.090490000000000001,0.082199999999999995],"mode":"lines+markers","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)","width":3}},"type":"scatter","name":"train_loss","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10],"y":[0.19366,0.16997999999999999,0.15747,0.14906,0.14341999999999999,0.13965,0.1368,0.13483999999999999,0.13342999999999999,0.13236999999999999],"mode":"lines+markers","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)","width":3}},"type":"scatter","name":"validation_loss","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"line":{"color":"rgba(214,39,40,1)"},"xaxis":"x2","yaxis":"y2","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"zerolinecolor":"#ffff","zerolinewidth":2,"gridcolor":"ffff","anchor":"y"},"xaxis2":{"domain":[0,1],"automargin":true,"zerolinecolor":"#ffff","zerolinewidth":2,"gridcolor":"ffff","anchor":"y2"},"yaxis2":{"domain":[0,0.47999999999999998],"automargin":true,"zerolinecolor":"#ffff","zerolinewidth":2,"gridcolor":"ffff","anchor":"x2"},"yaxis":{"domain":[0.52000000000000002,1],"automargin":true,"zerolinecolor":"#ffff","zerolinewidth":2,"gridcolor":"ffff","anchor":"x"},"annotations":[],"shapes":[],"images":[],"margin":{"b":40,"l":60,"t":25,"r":10},"plot_bgcolor":"#e5ecf6","hovermode":"closest","showlegend":true},"attrs":{"20f6413b3a07":{"x":[1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10],"y":[90.828999999999994,97.186000000000007,98.596999999999994,99.388999999999996,99.781000000000006,99.930999999999997,99.988,99.995000000000005,100,100,95.027000000000001,95.626999999999995,95.608000000000004,95.715999999999994,95.805000000000007,95.754999999999995,95.677000000000007,95.754999999999995,95.754999999999995,95.686000000000007],"mode":"lines+markers","marker":{"line":{"width":3}},"split":["train_accuracy","train_accuracy","train_accuracy","train_accuracy","train_accuracy","train_accuracy","train_accuracy","train_accuracy","train_accuracy","train_accuracy","validation_accuracy","validation_accuracy","validation_accuracy","validation_accuracy","validation_accuracy","validation_accuracy","validation_accuracy","validation_accuracy","validation_accuracy","validation_accuracy"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"20f6175ec306":{"x":[1,2,3,4,5,6,7,8,9,10,1,2,3,4,5,6,7,8,9,10],"y":[0.4622,0.29366999999999999,0.22137000000000001,0.17862,0.14979999999999999,0.12891,0.11304,0.10056,0.090490000000000001,0.082199999999999995,0.19366,0.16997999999999999,0.15747,0.14906,0.14341999999999999,0.13965,0.1368,0.13483999999999999,0.13342999999999999,0.13236999999999999],"mode":"lines+markers","marker":{"line":{"width":3}},"split":["train_loss","train_loss","train_loss","train_loss","train_loss","train_loss","train_loss","train_loss","train_loss","train_loss","validation_loss","validation_loss","validation_loss","validation_loss","validation_loss","validation_loss","validation_loss","validation_loss","validation_loss","validation_loss"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.3.1 (2023-06-16)</span></span>
<span><span class="co">## Platform: aarch64-apple-darwin20 (64-bit)</span></span>
<span><span class="co">## Running under: macOS Ventura 13.5.2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib </span></span>
<span><span class="co">## LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: America/Los_Angeles</span></span>
<span><span class="co">## tzcode source: internal</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] ggplot2_3.4.4      Seurat_5.0.1       SeuratObject_5.0.1 sp_2.1-2          </span></span>
<span><span class="co">## [5] viewmastR_0.2.0   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] fs_1.6.3                    matrixStats_1.1.0          </span></span>
<span><span class="co">##   [3] spatstat.sparse_3.0-3       bitops_1.0-7               </span></span>
<span><span class="co">##   [5] RcppMsgPack_0.2.3           lubridate_1.9.3            </span></span>
<span><span class="co">##   [7] httr_1.4.7                  RColorBrewer_1.1-3         </span></span>
<span><span class="co">##   [9] doParallel_1.0.17           tools_4.3.1                </span></span>
<span><span class="co">##  [11] sctransform_0.4.1           backports_1.4.1            </span></span>
<span><span class="co">##  [13] utf8_1.2.4                  R6_2.5.1                   </span></span>
<span><span class="co">##  [15] lazyeval_0.2.2              uwot_0.1.16                </span></span>
<span><span class="co">##  [17] GetoptLong_1.0.5            withr_2.5.2                </span></span>
<span><span class="co">##  [19] gridExtra_2.3               scCustomize_2.0.1          </span></span>
<span><span class="co">##  [21] progressr_0.14.0            cli_3.6.1                  </span></span>
<span><span class="co">##  [23] Biobase_2.60.0              textshaping_0.3.7          </span></span>
<span><span class="co">##  [25] Cairo_1.6-2                 spatstat.explore_3.2-5     </span></span>
<span><span class="co">##  [27] fastDummies_1.7.3           labeling_0.4.3             </span></span>
<span><span class="co">##  [29] sass_0.4.8                  spatstat.data_3.0-3        </span></span>
<span><span class="co">##  [31] proxy_0.4-27                ggridges_0.5.4             </span></span>
<span><span class="co">##  [33] pbapply_1.7-2               pkgdown_2.0.7              </span></span>
<span><span class="co">##  [35] systemfonts_1.0.5           foreign_0.8-86             </span></span>
<span><span class="co">##  [37] parallelly_1.36.0           rstudioapi_0.15.0          </span></span>
<span><span class="co">##  [39] generics_0.1.3              shape_1.4.6                </span></span>
<span><span class="co">##  [41] crosstalk_1.2.1             ica_1.0-3                  </span></span>
<span><span class="co">##  [43] spatstat.random_3.2-2       dplyr_1.1.4                </span></span>
<span><span class="co">##  [45] Matrix_1.6-4                ggbeeswarm_0.7.2           </span></span>
<span><span class="co">##  [47] fansi_1.0.6                 S4Vectors_0.38.2           </span></span>
<span><span class="co">##  [49] abind_1.4-5                 terra_1.7-55               </span></span>
<span><span class="co">##  [51] lifecycle_1.0.4             yaml_2.3.7                 </span></span>
<span><span class="co">##  [53] snakecase_0.11.1            SummarizedExperiment_1.30.2</span></span>
<span><span class="co">##  [55] recipes_1.0.8               Rtsne_0.17                 </span></span>
<span><span class="co">##  [57] paletteer_1.5.0             grid_4.3.1                 </span></span>
<span><span class="co">##  [59] promises_1.2.1              crayon_1.5.2               </span></span>
<span><span class="co">##  [61] miniUI_0.1.1.1              lattice_0.22-5             </span></span>
<span><span class="co">##  [63] cowplot_1.1.1               pillar_1.9.0               </span></span>
<span><span class="co">##  [65] knitr_1.45                  ComplexHeatmap_2.16.0      </span></span>
<span><span class="co">##  [67] GenomicRanges_1.52.1        rjson_0.2.21               </span></span>
<span><span class="co">##  [69] boot_1.3-28.1               future.apply_1.11.0        </span></span>
<span><span class="co">##  [71] codetools_0.2-19            leiden_0.4.3.1             </span></span>
<span><span class="co">##  [73] glue_1.6.2                  MatrixExtra_0.1.14         </span></span>
<span><span class="co">##  [75] data.table_1.14.10          float_0.3-1                </span></span>
<span><span class="co">##  [77] vctrs_0.6.5                 png_0.1-8                  </span></span>
<span><span class="co">##  [79] spam_2.10-0                 gtable_0.3.4               </span></span>
<span><span class="co">##  [81] rematch2_2.1.2              assertthat_0.2.1           </span></span>
<span><span class="co">##  [83] cachem_1.0.8                gower_1.0.1                </span></span>
<span><span class="co">##  [85] xfun_0.41                   S4Arrays_1.0.6             </span></span>
<span><span class="co">##  [87] mime_0.12                   prodlim_2023.08.28         </span></span>
<span><span class="co">##  [89] survival_3.5-7              timeDate_4022.108          </span></span>
<span><span class="co">##  [91] SingleCellExperiment_1.22.0 iterators_1.0.14           </span></span>
<span><span class="co">##  [93] pbmcapply_1.5.1             hardhat_1.3.0              </span></span>
<span><span class="co">##  [95] lava_1.7.3                  ellipsis_0.3.2             </span></span>
<span><span class="co">##  [97] fitdistrplus_1.1-11         ROCR_1.0-11                </span></span>
<span><span class="co">##  [99] ipred_0.9-14                nlme_3.1-164               </span></span>
<span><span class="co">## [101] RcppAnnoy_0.0.21            GenomeInfoDb_1.36.4        </span></span>
<span><span class="co">## [103] rprojroot_2.0.4             bslib_0.6.1                </span></span>
<span><span class="co">## [105] irlba_2.3.5.1               vipor_0.4.5                </span></span>
<span><span class="co">## [107] KernSmooth_2.23-22          rpart_4.1.23               </span></span>
<span><span class="co">## [109] colorspace_2.1-0            BiocGenerics_0.46.0        </span></span>
<span><span class="co">## [111] Hmisc_5.1-1                 nnet_7.3-19                </span></span>
<span><span class="co">## [113] ggrastr_1.0.2               tidyselect_1.2.0           </span></span>
<span><span class="co">## [115] compiler_4.3.1              htmlTable_2.4.2            </span></span>
<span><span class="co">## [117] desc_1.4.2                  DelayedArray_0.26.7        </span></span>
<span><span class="co">## [119] plotly_4.10.3               checkmate_2.3.1            </span></span>
<span><span class="co">## [121] scales_1.3.0                lmtest_0.9-40              </span></span>
<span><span class="co">## [123] stringr_1.5.1               digest_0.6.33              </span></span>
<span><span class="co">## [125] goftest_1.2-3               spatstat.utils_3.0-4       </span></span>
<span><span class="co">## [127] minqa_1.2.6                 rmarkdown_2.25             </span></span>
<span><span class="co">## [129] XVector_0.40.0              RhpcBLASctl_0.23-42        </span></span>
<span><span class="co">## [131] htmltools_0.5.7             pkgconfig_2.0.3            </span></span>
<span><span class="co">## [133] base64enc_0.1-3             lme4_1.1-35.1              </span></span>
<span><span class="co">## [135] sparseMatrixStats_1.12.2    MatrixGenerics_1.12.3      </span></span>
<span><span class="co">## [137] highr_0.10                  fastmap_1.1.1              </span></span>
<span><span class="co">## [139] rlang_1.1.2                 GlobalOptions_0.1.2        </span></span>
<span><span class="co">## [141] htmlwidgets_1.6.4           shiny_1.8.0                </span></span>
<span><span class="co">## [143] DelayedMatrixStats_1.22.6   farver_2.1.1               </span></span>
<span><span class="co">## [145] jquerylib_0.1.4             zoo_1.8-12                 </span></span>
<span><span class="co">## [147] jsonlite_1.8.8              ModelMetrics_1.2.2.2       </span></span>
<span><span class="co">## [149] RCurl_1.98-1.13             magrittr_2.0.3             </span></span>
<span><span class="co">## [151] Formula_1.2-5               GenomeInfoDbData_1.2.10    </span></span>
<span><span class="co">## [153] dotCall64_1.1-1             patchwork_1.1.3            </span></span>
<span><span class="co">## [155] munsell_0.5.0               Rcpp_1.0.11                </span></span>
<span><span class="co">## [157] reticulate_1.34.0           stringi_1.8.2              </span></span>
<span><span class="co">## [159] pROC_1.18.5                 zlibbioc_1.46.0            </span></span>
<span><span class="co">## [161] MASS_7.3-60                 plyr_1.8.9                 </span></span>
<span><span class="co">## [163] parallel_4.3.1              listenv_0.9.0              </span></span>
<span><span class="co">## [165] ggrepel_0.9.4               forcats_1.0.0              </span></span>
<span><span class="co">## [167] deldir_2.0-2                splines_4.3.1              </span></span>
<span><span class="co">## [169] tensor_1.5                  circlize_0.4.15            </span></span>
<span><span class="co">## [171] igraph_1.5.1                spatstat.geom_3.2-7        </span></span>
<span><span class="co">## [173] RcppHNSW_0.5.0              reshape2_1.4.4             </span></span>
<span><span class="co">## [175] stats4_4.3.1                evaluate_0.23              </span></span>
<span><span class="co">## [177] ggprism_1.0.4               nloptr_2.0.3               </span></span>
<span><span class="co">## [179] foreach_1.5.2               httpuv_1.6.13              </span></span>
<span><span class="co">## [181] RANN_2.6.1                  tidyr_1.3.0                </span></span>
<span><span class="co">## [183] purrr_1.0.2                 polyclip_1.10-6            </span></span>
<span><span class="co">## [185] future_1.33.0               clue_0.3-65                </span></span>
<span><span class="co">## [187] scattermore_1.2             janitor_2.2.0              </span></span>
<span><span class="co">## [189] xtable_1.8-4                monocle3_1.3.4             </span></span>
<span><span class="co">## [191] e1071_1.7-14                RSpectra_0.16-1            </span></span>
<span><span class="co">## [193] later_1.3.2                 viridisLite_0.4.2          </span></span>
<span><span class="co">## [195] class_7.3-22                ragg_1.2.6                 </span></span>
<span><span class="co">## [197] tibble_3.2.1                memoise_2.0.1              </span></span>
<span><span class="co">## [199] beeswarm_0.4.0              IRanges_2.34.1             </span></span>
<span><span class="co">## [201] cluster_2.1.6               timechange_0.2.0           </span></span>
<span><span class="co">## [203] globals_0.16.2              caret_6.0-94</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/Users/sfurlan/develop/viewmastR/vignettes"</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://furlan-lab.github.io" class="external-link">Scott Furlan</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
