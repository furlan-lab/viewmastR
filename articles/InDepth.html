<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A deeper look at viewmastR • viewmastR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/IBM_Plex_Sans-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Fira_Mono-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Alegreya_Sans_SC-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="A deeper look at viewmastR">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">viewmastR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Get Started</h6></li>
    <li><a class="dropdown-item" href="../articles/HowTo.html">How to use viewmastR</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Advanced</h6></li>
    <li><a class="dropdown-item" href="../articles/InDepth.html">A deeper look at viewmastR</a></li>
    <li><a class="dropdown-item" href="../articles/BulkReference.html">How to use a bulk dataset as a reference for viewmastR</a></li>
    <li><a class="dropdown-item" href="../articles/Augment.html">How to augment data using viewmastR</a></li>
    <li><a class="dropdown-item" href="../articles/SavedModel.html">How to use viewmastR with saved models</a></li>
    <li><a class="dropdown-item" href="../articles/Extras.html">Extra functions</a></li>
    <li><a class="dropdown-item" href="../articles/BigQuery.html">How to use viewmastR with large query objects</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="http://twitter.com/scottfurlan" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/furlan-lab/viewmastR" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="InDepth_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="InDepth_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="InDepth_files/plotly-binding-4.10.4/plotly.js"></script><script src="InDepth_files/typedarray-0.1/typedarray.min.js"></script><link href="InDepth_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="InDepth_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><link href="InDepth_files/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="InDepth_files/plotly-main-2.11.1/plotly-latest.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>A deeper look at viewmastR</h1>
            
            <h4 data-toc-skip class="date">2024-08-08</h4>
      

      <div class="d-none name"><code>InDepth.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="a-deeper-look-at-viewmastr">A Deeper Look at <code>viewmastR</code><a class="anchor" aria-label="anchor" href="#a-deeper-look-at-viewmastr"></a>
</h2>
<p>Before diving into how <code>viewmastR</code> works, let’s first set
up the necessary environment and go through essential functions to
streamline your training and analysis workflow.</p>
<div class="section level3">
<h3 id="installing-rust">
<strong>1. Installing Rust</strong><a class="anchor" aria-label="anchor" href="#installing-rust"></a>
</h3>
<p>Before using <code>viewmastR</code>, you’ll need an updated
installation of <strong>Rust</strong>, as it’s a core dependency. Follow
the instructions on the official <a href="https://www.rust-lang.org/tools/install" class="external-link">Rust installation
page</a> to set up Rust on your system.</p>
</div>
<div class="section level3">
<h3 id="installing-viewmastr">
<strong>2. Installing <code>viewmastR</code></strong><a class="anchor" aria-label="anchor" href="#installing-viewmastr"></a>
</h3>
<p>Once Rust is installed, you can install <code>viewmastR</code>
directly from GitHub. Ensure you have the <code>devtools</code> package
installed, and then use the following command:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"furlan-lab/viewmastR"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="viewing-the-training-history">
<strong>3. Viewing the Training History</strong><a class="anchor" aria-label="anchor" href="#viewing-the-training-history"></a>
</h3>
<p><code>viewmastR</code> tracks key data during the training process,
which can be accessed by setting the <code>return_type</code> parameter
to <code>"list"</code>. This returns: 1. The query object with predicted
cell types. 2. The training results.</p>
<p>Here’s how you can retrieve and visualize the training data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://furlan-lab.github.io/viewmastR/">viewmastR</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/samuel-marsh/scCustomize" class="external-link">scCustomize</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com" class="external-link">plotly</a></span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load query and reference datasets</span></span>
<span><span class="va">seu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ROOT_DIR1</span>, <span class="st">"240813_final_object.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vg</span> <span class="op">&lt;-</span> <span class="fu">get_selected_features</span><span class="op">(</span><span class="va">seu</span><span class="op">)</span></span>
<span><span class="va">seur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">ROOT_DIR2</span>, <span class="st">"230329_rnaAugmented_seurat.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View training history</span></span>
<span><span class="va">output_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/viewmastR.html">viewmastR</a></span><span class="op">(</span><span class="va">seu</span>, <span class="va">seur</span>, ref_celldata_col <span class="op">=</span> <span class="st">"SFClassification"</span>, selected_features <span class="op">=</span> <span class="va">vg</span>, return_type <span class="op">=</span> <span class="st">"list"</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="visualizing-training-data">Visualizing Training Data<a class="anchor" aria-label="anchor" href="#visualizing-training-data"></a>
</h4>
<p>To plot training vs validation loss, you can use the following:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_training_data.html">plot_training_data</a></span><span class="op">(</span><span class="va">output_list</span><span class="op">)</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:403.2px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"data":[{"x":[1,2,3,4,5],"y":[90.179000000000002,97.013999999999996,98.406999999999996,99.278999999999996,99.706999999999994],"mode":"lines+markers","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)","width":3}},"type":"scatter","name":"train_accuracy","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[95.331999999999994,95.450000000000003,95.754999999999995,95.864000000000004,95.834000000000003],"mode":"lines+markers","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)","width":3}},"type":"scatter","name":"validation_accuracy","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.47011999999999998,0.29976000000000003,0.2268,0.18368000000000001,0.15454999999999999],"mode":"lines+markers","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)","width":3}},"type":"scatter","name":"train_loss","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":[1,2,3,4,5],"y":[0.19306999999999999,0.17188999999999999,0.158,0.14910000000000001,0.14312],"mode":"lines+markers","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)","width":3}},"type":"scatter","name":"validation_loss","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"line":{"color":"rgba(214,39,40,1)"},"xaxis":"x2","yaxis":"y2","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"zerolinecolor":"#ffff","zerolinewidth":2,"gridcolor":"ffff","anchor":"y"},"xaxis2":{"domain":[0,1],"automargin":true,"zerolinecolor":"#ffff","zerolinewidth":2,"gridcolor":"ffff","anchor":"y2"},"yaxis2":{"domain":[0,0.47999999999999998],"automargin":true,"zerolinecolor":"#ffff","zerolinewidth":2,"gridcolor":"ffff","anchor":"x2"},"yaxis":{"domain":[0.52000000000000002,1],"automargin":true,"zerolinecolor":"#ffff","zerolinewidth":2,"gridcolor":"ffff","anchor":"x"},"annotations":[],"shapes":[],"images":[],"margin":{"b":40,"l":60,"t":25,"r":10},"plot_bgcolor":"#e5ecf6","hovermode":"closest","showlegend":true},"attrs":{"168813ff39e1b":{"x":[1,2,3,4,5,1,2,3,4,5],"y":[90.179000000000002,97.013999999999996,98.406999999999996,99.278999999999996,99.706999999999994,95.331999999999994,95.450000000000003,95.754999999999995,95.864000000000004,95.834000000000003],"mode":"lines+markers","marker":{"line":{"width":3}},"split":["train_accuracy","train_accuracy","train_accuracy","train_accuracy","train_accuracy","validation_accuracy","validation_accuracy","validation_accuracy","validation_accuracy","validation_accuracy"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"1688113111f6a":{"x":[1,2,3,4,5,1,2,3,4,5],"y":[0.47011999999999998,0.29976000000000003,0.2268,0.18368000000000001,0.15454999999999999,0.19306999999999999,0.17188999999999999,0.158,0.14910000000000001,0.14312],"mode":"lines+markers","marker":{"line":{"width":3}},"split":["train_loss","train_loss","train_loss","train_loss","train_loss","validation_loss","validation_loss","validation_loss","validation_loss","validation_loss"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><p>For rendering the plot without details:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_training_data.html">plot_training_data</a></span><span class="op">(</span><span class="va">output_list</span><span class="op">)</span></span>
<span><span class="va">plt</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:100%;height:403.2px;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"data":[{"x":[1,2,3,4,5],"y":[90.179000000000002,97.013999999999996,98.406999999999996,99.278999999999996,99.706999999999994],"mode":"lines+markers","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)","width":3}},"type":"scatter","name":"train_accuracy","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[95.331999999999994,95.450000000000003,95.754999999999995,95.864000000000004,95.834000000000003],"mode":"lines+markers","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)","width":3}},"type":"scatter","name":"validation_accuracy","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5],"y":[0.47011999999999998,0.29976000000000003,0.2268,0.18368000000000001,0.15454999999999999],"mode":"lines+markers","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)","width":3}},"type":"scatter","name":"train_loss","error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x2","yaxis":"y2","frame":null},{"x":[1,2,3,4,5],"y":[0.19306999999999999,0.17188999999999999,0.158,0.14910000000000001,0.14312],"mode":"lines+markers","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)","width":3}},"type":"scatter","name":"validation_loss","error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"line":{"color":"rgba(214,39,40,1)"},"xaxis":"x2","yaxis":"y2","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"zerolinecolor":"#ffff","zerolinewidth":2,"gridcolor":"ffff","anchor":"y"},"xaxis2":{"domain":[0,1],"automargin":true,"zerolinecolor":"#ffff","zerolinewidth":2,"gridcolor":"ffff","anchor":"y2"},"yaxis2":{"domain":[0,0.47999999999999998],"automargin":true,"zerolinecolor":"#ffff","zerolinewidth":2,"gridcolor":"ffff","anchor":"x2"},"yaxis":{"domain":[0.52000000000000002,1],"automargin":true,"zerolinecolor":"#ffff","zerolinewidth":2,"gridcolor":"ffff","anchor":"x"},"annotations":[],"shapes":[],"images":[],"margin":{"b":40,"l":60,"t":25,"r":10},"plot_bgcolor":"#e5ecf6","hovermode":"closest","showlegend":true},"attrs":{"168816dcd0ca3":{"x":[1,2,3,4,5,1,2,3,4,5],"y":[90.179000000000002,97.013999999999996,98.406999999999996,99.278999999999996,99.706999999999994,95.331999999999994,95.450000000000003,95.754999999999995,95.864000000000004,95.834000000000003],"mode":"lines+markers","marker":{"line":{"width":3}},"split":["train_accuracy","train_accuracy","train_accuracy","train_accuracy","train_accuracy","validation_accuracy","validation_accuracy","validation_accuracy","validation_accuracy","validation_accuracy"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"1688130f8d9a6":{"x":[1,2,3,4,5,1,2,3,4,5],"y":[0.47011999999999998,0.29976000000000003,0.2268,0.18368000000000001,0.15454999999999999,0.19306999999999999,0.17188999999999999,0.158,0.14910000000000001,0.14312],"mode":"lines+markers","marker":{"line":{"width":3}},"split":["train_loss","train_loss","train_loss","train_loss","train_loss","validation_loss","validation_loss","validation_loss","validation_loss","validation_loss"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script><blockquote>
<p><strong>Tip</strong>: If the training loss decreases while the
validation loss plateaus, it may indicate
<strong>overfitting</strong>.</p>
</blockquote>
</div>
</div>
<div class="section level3">
<h3 id="tuning-for-speed">
<strong>4. Tuning for Speed</strong><a class="anchor" aria-label="anchor" href="#tuning-for-speed"></a>
</h3>
<p><code>viewmastR</code> runs with 3 available backends (see <a href="https://burn.dev/burn-book/basic-workflow/backend.html" class="external-link">Burn</a>
for more details). In our hands the <code>nd</code> backend tends to run
faster on Apple M1/M2 processors. Note that using “auto” for the backend
parameter (which is the default) will detect architecture and provide
our best guess which backend will be the fastest for you. But if you
want to test yourself, here’s how you can compare the performance of
different backends on your system:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/viewmastR.html">viewmastR</a></span><span class="op">(</span><span class="va">seu</span>, <span class="va">seur</span>, ref_celldata_col <span class="op">=</span> <span class="st">"SFClassification"</span>, selected_features <span class="op">=</span> <span class="va">vg</span>, max_epochs <span class="op">=</span> <span class="fl">3</span>, backend <span class="op">=</span> <span class="st">"candle"</span>, return_type <span class="op">=</span> <span class="st">"list"</span><span class="op">)</span></span>
<span><span class="va">run2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/viewmastR.html">viewmastR</a></span><span class="op">(</span><span class="va">seu</span>, <span class="va">seur</span>, ref_celldata_col <span class="op">=</span> <span class="st">"SFClassification"</span>, selected_features <span class="op">=</span> <span class="va">vg</span>, max_epochs <span class="op">=</span> <span class="fl">3</span>, backend <span class="op">=</span> <span class="st">"wgpu"</span>, return_type <span class="op">=</span> <span class="st">"list"</span><span class="op">)</span></span>
<span><span class="va">run3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/viewmastR.html">viewmastR</a></span><span class="op">(</span><span class="va">seu</span>, <span class="va">seur</span>, ref_celldata_col <span class="op">=</span> <span class="st">"SFClassification"</span>, selected_features <span class="op">=</span> <span class="va">vg</span>, max_epochs <span class="op">=</span> <span class="fl">3</span>, backend <span class="op">=</span> <span class="st">"nd"</span>, return_type <span class="op">=</span> <span class="st">"list"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare training times</span></span>
<span><span class="va">gp</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>training_times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">run1</span><span class="op">$</span><span class="va">training_output</span><span class="op">$</span><span class="va">duration</span><span class="op">$</span><span class="va">training_duration</span>,</span>
<span>                                    <span class="va">run2</span><span class="op">$</span><span class="va">training_output</span><span class="op">$</span><span class="va">duration</span><span class="op">$</span><span class="va">training_duration</span>,</span>
<span>                                    <span class="va">run3</span><span class="op">$</span><span class="va">training_output</span><span class="op">$</span><span class="va">duration</span><span class="op">$</span><span class="va">training_duration</span><span class="op">)</span>, </span>
<span>                  backend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"candle"</span>, <span class="st">"wgpu"</span>, <span class="st">"nd"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">backend</span>, y <span class="op">=</span> <span class="va">training_times</span>, fill <span class="op">=</span> <span class="va">backend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Backend"</span>, y <span class="op">=</span> <span class="st">"Training Time (s)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://satijalab.org/seurat/reference/SeuratTheme.html" class="external-link">NoLegend</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Arch: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.info.html" class="external-link">Sys.info</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="st">"machine"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">ggplotly</a></span><span class="op">(</span><span class="va">gp</span><span class="op">)</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item" id="htmlwidget-36aa3d2a04d42bbc2145" style="width:100%;height:403.2px;"></div>
<script type="application/json" data-for="htmlwidget-36aa3d2a04d42bbc2145">{"x":{"data":[{"orientation":"v","width":0.89999999999999991,"base":0,"x":[1],"y":[8.2104518750000004],"text":"backend: candle<br />training_times:  8.210452<br />backend: candle","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","line":{"width":1.8897637795275593,"color":"transparent"}},"name":"candle","legendgroup":"candle","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.90000000000000013,"base":0,"x":[2],"y":[4.1812458750000001],"text":"backend: nd<br />training_times:  4.181246<br />backend: nd","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,186,56,1)","line":{"width":1.8897637795275593,"color":"transparent"}},"name":"nd","legendgroup":"nd","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.90000000000000036,"base":0,"x":[3],"y":[14.846241459],"text":"backend: wgpu<br />training_times: 14.846241<br />backend: wgpu","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(97,156,255,1)","line":{"width":1.8897637795275593,"color":"transparent"}},"name":"wgpu","legendgroup":"wgpu","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":43.976477786464535,"r":7.3059360730593621,"b":40.396569110665453,"l":37.260273972602747},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"Arch:  arm64","font":{"color":"rgba(0,0,0,1)","family":"","size":17.534246575342468},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.40000000000000002,3.6000000000000001],"tickmode":"array","ticktext":["candle","nd","wgpu"],"tickvals":[1,2,3],"categoryorder":"array","categoryarray":["candle","nd","wgpu"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Backend","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.74231207295000001,15.58855353195],"tickmode":"array","ticktext":["0","5","10","15"],"tickvals":[0,5,10,15],"categoryorder":"array","categoryarray":["0","5","10","15"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Training Time (s)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"168811cd16965":{"x":{},"y":{},"fill":{},"type":"bar"}},"cur_data":"168811cd16965","visdat":{"168811cd16965":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="saving-training-subsets">
<strong>5. Saving Training Subsets</strong><a class="anchor" aria-label="anchor" href="#saving-training-subsets"></a>
</h3>
<p>To inspect the training and test data used by <code>viewmastR</code>
we provide the setup_training function if you so desire to evaluate
these using other learning frameworks.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ti</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_training.html">setup_training</a></span><span class="op">(</span><span class="va">seu</span>, <span class="va">seur</span>, ref_celldata_col <span class="op">=</span> <span class="st">"SFClassification"</span>, selected_features <span class="op">=</span> <span class="va">vg</span>, return_type <span class="op">=</span> <span class="st">"matrix"</span>, backend <span class="op">=</span> <span class="va">backend</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert labels to max class and save them</span></span>
<span><span class="va">train_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">ti</span><span class="op">$</span><span class="va">Ytrain_label</span>, <span class="fl">1</span>, <span class="va">which.max</span><span class="op">)</span></span>
<span><span class="va">test_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">ti</span><span class="op">$</span><span class="va">Ytest_label</span>, <span class="fl">1</span>, <span class="va">which.max</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save training data and labels</span></span>
<span><span class="fu"><a href="../reference/writeMMgz.html">writeMMgz</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">ti</span><span class="op">$</span><span class="va">Xtrain_data</span>, <span class="st">"dgCMatrix"</span><span class="op">)</span>, <span class="st">"/path/to/train.mm.gz"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/writeMMgz.html">writeMMgz</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">ti</span><span class="op">$</span><span class="va">Xtest_data</span>, <span class="st">"dgCMatrix"</span><span class="op">)</span>, <span class="st">"/path/to/test.mm.gz"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/writeMMgz.html">writeMMgz</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">ti</span><span class="op">$</span><span class="va">query</span>, <span class="st">"dgCMatrix"</span><span class="op">)</span>, <span class="st">"/path/to/query.mm.gz"</span><span class="op">)</span></span>
<span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>train <span class="op">=</span> <span class="va">train_label</span><span class="op">)</span>, <span class="st">"/path/to/train_labels.tsv.gz"</span>, compress <span class="op">=</span> <span class="st">"gzip"</span><span class="op">)</span></span>
<span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>test <span class="op">=</span> <span class="va">test_label</span><span class="op">)</span>, <span class="st">"/path/to/test_labels.tsv.gz"</span>, compress <span class="op">=</span> <span class="st">"gzip"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="analyzing-probabilities">
<strong>6. Analyzing Probabilities</strong><a class="anchor" aria-label="anchor" href="#analyzing-probabilities"></a>
</h3>
<p>Run inference and obtain prediction probabilities:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">training_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/viewmastR.html">viewmastR</a></span><span class="op">(</span>ref_cds <span class="op">=</span> <span class="va">seur</span>, ref_celldata_col <span class="op">=</span> <span class="st">"SFClassification"</span>, selected_features <span class="op">=</span> <span class="va">vg</span>, max_epochs <span class="op">=</span> <span class="fl">3</span>, train_only <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Obtain prediction probabilities</span></span>
<span><span class="va">seu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/viewmastR_infer.html">viewmastR_infer</a></span><span class="op">(</span><span class="va">seu</span>, model_dir <span class="op">=</span> <span class="va">training_output</span><span class="op">[[</span><span class="st">"model_dir"</span><span class="op">]</span><span class="op">]</span>, selected_features <span class="op">=</span> <span class="va">vg</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">seur</span><span class="op">$</span><span class="va">SFClassification</span><span class="op">)</span><span class="op">)</span>, return_probs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">scCustomize</span><span class="fu">::</span><span class="fu"><a href="https://samuel-marsh.github.io/scCustomize/reference/FeaturePlot_scCustom.html" class="external-link">FeaturePlot_scCustom</a></span><span class="op">(</span><span class="va">seu</span>, features <span class="op">=</span> <span class="st">"prob_19_CD8.EM"</span><span class="op">)</span></span></code></pre></div>
<p><img src="InDepth_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="evaluating-model-weights">
<strong>7. Evaluating Model Weights</strong><a class="anchor" aria-label="anchor" href="#evaluating-model-weights"></a>
</h3>
<p>To inspect model weights (note this only works for mlr - see
below):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="st">"/tmp/sc_local"</span></span>
<span><span class="va">wmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_weights.html">get_weights</a></span><span class="op">(</span><span class="va">dir</span><span class="op">)</span></span>
<span><span class="va">top_NK_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">wmat</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">wmat</span><span class="op">$</span><span class="st">'21_NK'</span>, index.return<span class="op">=</span><span class="cn">T</span>, decreasing<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">$</span><span class="va">ix</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">seu</span> <span class="op">&lt;-</span><span class="fu"><a href="https://satijalab.org/seurat/reference/AddModuleScore.html" class="external-link">AddModuleScore</a></span><span class="op">(</span><span class="va">seu</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>top_nk_genes<span class="op">=</span><span class="va">top_NK_genes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://samuel-marsh.github.io/scCustomize/reference/FeaturePlot_scCustom.html" class="external-link">FeaturePlot_scCustom</a></span><span class="op">(</span><span class="va">seu</span>, features <span class="op">=</span> <span class="st">"Cluster1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="InDepth_files/figure-html/unnamed-chunk-9-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="comparing-different-algorithms">
<strong>8. Comparing Different Algorithms</strong><a class="anchor" aria-label="anchor" href="#comparing-different-algorithms"></a>
</h3>
<p><code>viewmastR</code> supports various algorithms, such as <strong>a
pseudo multinomial logistic regression (mlr)</strong>,
<strong>multinomial naive bayes (nb)</strong>, and a <strong>multi-layer
perceptron (nn)</strong>. You can read more about the similarity between
this simple neural network and logistic regression here (<a href="https://medium.com/@axegggl/neural-networks-decoded-how-logistic-regression-is-the-hidden-first-step-495f4a0b5fd#" class="external-link uri">https://medium.com/@axegggl/neural-networks-decoded-how-logistic-regression-is-the-hidden-first-step-495f4a0b5fd#</a>:~:text=When%20you%20think%20about%20a,like%20a%20logistic%20regression%20model.)</p>
<p>The code below shows how you can run and compare these methods:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/viewmastR.html">viewmastR</a></span><span class="op">(</span><span class="va">seu</span>, <span class="va">seur</span>, ref_celldata_col <span class="op">=</span> <span class="st">"SFClassification"</span>, FUNC <span class="op">=</span> <span class="st">"mlr"</span>, query_celldata_col <span class="op">=</span> <span class="st">"mlr_pred"</span>, selected_features <span class="op">=</span> <span class="va">vg</span>, max_epochs <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">seu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/viewmastR.html">viewmastR</a></span><span class="op">(</span><span class="va">seu</span>, <span class="va">seur</span>, ref_celldata_col <span class="op">=</span> <span class="st">"SFClassification"</span>, FUNC <span class="op">=</span> <span class="st">"nb"</span>, query_celldata_col <span class="op">=</span> <span class="st">"nb_pred"</span>, selected_features <span class="op">=</span> <span class="va">vg</span><span class="op">)</span></span>
<span><span class="va">seu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/viewmastR.html">viewmastR</a></span><span class="op">(</span><span class="va">seu</span>, <span class="va">seur</span>, ref_celldata_col <span class="op">=</span> <span class="st">"SFClassification"</span>, FUNC <span class="op">=</span> <span class="st">"nn"</span>, query_celldata_col <span class="op">=</span> <span class="st">"nn_pred"</span>, selected_genes <span class="op">=</span> <span class="va">vg</span>, hidden_layers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>, max_epochs <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">seu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/viewmastR.html">viewmastR</a></span><span class="op">(</span><span class="va">seu</span>, <span class="va">seur</span>, ref_celldata_col <span class="op">=</span> <span class="st">"SFClassification"</span>, FUNC <span class="op">=</span> <span class="st">"nn"</span>, query_celldata_col <span class="op">=</span> <span class="st">"nn2_pred"</span>, selected_genes <span class="op">=</span> <span class="va">vg</span>, hidden_layers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">150</span><span class="op">)</span>, max_epochs <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Visualize predictions</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">seu</span>, group.by <span class="op">=</span> <span class="st">"mlr_pred"</span><span class="op">)</span></span></code></pre></div>
<p><img src="InDepth_files/figure-html/unnamed-chunk-10-1.png" width="100%"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">seu</span>, group.by <span class="op">=</span> <span class="st">"nb_pred"</span><span class="op">)</span></span></code></pre></div>
<p><img src="InDepth_files/figure-html/unnamed-chunk-10-2.png" width="100%"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">seu</span>, group.by <span class="op">=</span> <span class="st">"nn_pred"</span><span class="op">)</span></span></code></pre></div>
<p><img src="InDepth_files/figure-html/unnamed-chunk-10-3.png" width="100%"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">seu</span>, group.by <span class="op">=</span> <span class="st">"nn2_pred"</span><span class="op">)</span></span></code></pre></div>
<p><img src="InDepth_files/figure-html/unnamed-chunk-10-4.png" width="100%"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Evaluate accuracy</span></span>
<span><span class="va">accuracy_mlr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">seu</span><span class="op">$</span><span class="va">mlr_pred</span> <span class="op">==</span> <span class="va">seu</span><span class="op">$</span><span class="va">ground_truth</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">seu</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">accuracy_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">seu</span><span class="op">$</span><span class="va">nb_pred</span> <span class="op">==</span> <span class="va">seu</span><span class="op">$</span><span class="va">ground_truth</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">seu</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">accuracy_nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">seu</span><span class="op">$</span><span class="va">nn_pred</span> <span class="op">==</span> <span class="va">seu</span><span class="op">$</span><span class="va">ground_truth</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">seu</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">accuracy_nn2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">seu</span><span class="op">$</span><span class="va">nn2_pred</span> <span class="op">==</span> <span class="va">seu</span><span class="op">$</span><span class="va">ground_truth</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">seu</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Compare accuracies</span></span>
<span><span class="va">gp</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">accuracy_mlr</span>, <span class="va">accuracy_nb</span>, <span class="va">accuracy_nn</span>, <span class="va">accuracy_nn2</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>, </span>
<span>                  algorithm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mlr"</span>, <span class="st">"nb"</span>, <span class="st">"nn"</span>,<span class="st">"nn2"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">algorithm</span>, y <span class="op">=</span> <span class="va">accuracy</span>, fill <span class="op">=</span> <span class="va">algorithm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Algorithm"</span>, y <span class="op">=</span> <span class="st">"Accuracy (%)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://satijalab.org/seurat/reference/SeuratTheme.html" class="external-link">NoLegend</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">ggplotly</a></span><span class="op">(</span><span class="va">gp</span><span class="op">)</span></span></code></pre></div>
<div class="plotly html-widget html-fill-item" id="htmlwidget-febe03efa1a2d8d52a86" style="width:100%;height:403.2px;"></div>
<script type="application/json" data-for="htmlwidget-febe03efa1a2d8d52a86">{"x":{"data":[{"orientation":"v","width":0.89999999999999991,"base":0,"x":[1],"y":[97.568093385213999],"text":"algorithm: mlr<br />accuracy: 97.56809<br />algorithm: mlr","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","line":{"width":1.8897637795275593,"color":"transparent"}},"name":"mlr","legendgroup":"mlr","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.90000000000000013,"base":0,"x":[2],"y":[96.816413158825611],"text":"algorithm: nb<br />accuracy: 96.81641<br />algorithm: nb","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(124,174,0,1)","line":{"width":1.8897637795275593,"color":"transparent"}},"name":"nb","legendgroup":"nb","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.90000000000000036,"base":0,"x":[3],"y":[96.692607003891055],"text":"algorithm: nn<br />accuracy: 96.69261<br />algorithm: nn","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","line":{"width":1.8897637795275593,"color":"transparent"}},"name":"nn","legendgroup":"nn","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":0.90000000000000036,"base":0,"x":[4],"y":[96.197382384152803],"text":"algorithm: nn2<br />accuracy: 96.19738<br />algorithm: nn2","type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(199,124,255,1)","line":{"width":1.8897637795275593,"color":"transparent"}},"name":"nn2","legendgroup":"nn2","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.442231211122067,"r":7.3059360730593621,"b":40.396569110665453,"l":43.105022831050235},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.40000000000000002,4.5999999999999996],"tickmode":"array","ticktext":["mlr","nb","nn","nn2"],"tickvals":[1,2,3,4],"categoryorder":"array","categoryarray":["mlr","nb","nn","nn2"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Algorithm","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-4.8784046692606999,102.4464980544747],"tickmode":"array","ticktext":["0","25","50","75","100"],"tickvals":[0,25,50.000000000000014,75,100],"categoryorder":"array","categoryarray":["0","25","50","75","100"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Accuracy (%)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"16881345e4a4":{"x":{},"y":{},"fill":{},"type":"bar"}},"cur_data":"16881345e4a4","visdat":{"16881345e4a4":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://furlan-lab.github.io" class="external-link">Scott Furlan</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
